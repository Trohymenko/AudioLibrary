@model IEnumerable<AudioLibrary.Models.TrackViewModel>


<script src='@Url.Content("~/Scripts/jquery-1.12.4.min.js")' type="text/javascript"></script>
<script src='@Url.Content("~/Scripts/jquery-ui-1.12.1.min.js")' type="text/javascript"></script>
<p>
    @Html.ActionLink("Upload", "Create")
</p>
<div>
    @using (Ajax.BeginForm("TrackSearch", "Home", new AjaxOptions { UpdateTargetId = "results" }))
    {
        <input type="search" name="name" width="3000" />
        <input type="submit" value="Search" />
    }

    <div id="results">

    </div>
    </div>
        <table class="table">
            <tr>
                <th>
                    @Html.DisplayNameFor(model => model.TrackName)
                </th>
                <th>
                    @Html.DisplayNameFor(model => model.AuthorName)
                </th>
                <th></th>
            </tr>

            @foreach (var item in Model)
            {
                <tr>
                    <td>
                        @Html.DisplayFor(modelItem => item.TrackName)
                    </td>
                    <td>
                        @foreach (var author in ViewBag.Authors)
                        {
                            if (item.AuthorID == author.AuthorID)
                            {
                                @author.AuthorName
                            }
                        }
                    </td>

                    <td>
                        @Html.ActionLink("Edit", "Edit", new { }) |
                        @Html.ActionLink("Details", "Details", "Tracks", new { id = item.TrackID }, new { @class = "viewDialog", data_dialog_title = "Details" }) |
                        @Html.ActionLink("Delete", "Delete", new { })
                    </td>
                    <td>
                        <audio width="400" height="300" controls src=@item.TrackAddress></audio>
                    </td>
                </tr>
            }

        </table>
        @section scripts
{
            <script>
                $(document).ready(function () {

                    $.ajaxSetup({ cache: false });

                    $(".viewDialog").on("click", function (e) {
                        e.preventDefault();

                        $("<div></div>")
                            .addClass("dialog")
                            .appendTo("body")
                            .dialog({
                                width: 450,
                                title: $(this).attr("data-dialog-title"),
                                close: function () { $(this).remove() },
                                modal: true
                            })
                            .load(this.href);
                    });
                });
            </script>
        }
